<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cart | Alankara</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body{
  font-family:'Segoe UI',sans-serif;
  padding-top:90px;
}

/* ===== NAVBAR ===== */
.navbar{
  background:rgba(0,0,0,0.75);
  position:fixed;
  top:0;
  width:100%;
  z-index:1000;
}
.navbar-brand,
.navbar .nav-link{
  color:#fff !important;
  font-weight:700;
}
.brand-black{color:#f3f5f6}
.brand-gold{color:#ffcd00}

.profile-icon{
  width:38px;
  height:38px;
  border-radius:50%;
  background:#ffcd00;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#700571;
  cursor:pointer;
}

/* ===== CART ===== */
.cart-item{border-bottom:1px solid #eee;padding:20px 0}
.cart-item img{width:70px;border-radius:10px}
.qty-box{
  display:flex;
  border:1px solid #000;
  width:100px;
  justify-content:space-between;
  align-items:center;
}
.qty-box button{
  border:0;
  background:none;
  width:30px;
  font-size:18px;
}
.remove{cursor:pointer;color:red;font-size:18px}
.progress{height:8px}

/* BUTTON FIX */
.btn-dark:focus,
.btn-dark:active{
  box-shadow:none!important;
}
</style>
</head>

<body>

<!-- ===== NAVBAR ===== -->
<nav class="navbar navbar-expand-lg px-4">
  <a class="navbar-brand" href="index.html">
    <span class="brand-black">ALAN</span><span class="brand-gold">KARA</span>
  </a>

  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
    <ul class="navbar-nav align-items-center">

      <li class="nav-item">
        <a class="nav-link" href="index.html">Home</a>
      </li>

      <li class="nav-item">
        <a class="nav-link active" href="cart.html">
          <i class="fas fa-shopping-cart"></i> Cart
        </a>
      </li>

      <li class="nav-item dropdown ms-3">
        <div class="profile-icon" data-bs-toggle="dropdown">
          <i class="fas fa-user"></i>
        </div>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="#">Profile</a></li>
          <li><a class="dropdown-item text-danger" href="#" id="logout-btn">Logout</a></li>
        </ul>
      </li>

    </ul>
  </div>
</nav>

<!-- ===== CART CONTENT ===== -->
<div class="container py-5">

<h3 class="text-center mb-4">
  Your Cart (<span id="item-count">0</span> items)
</h3>

<div class="row">

<!-- LEFT -->
<div class="col-lg-8">

<div class="row fw-bold border-bottom pb-2">
  <div class="col-6">Item</div>
  <div class="col-2">Price</div>
  <div class="col-2">Qty</div>
  <div class="col-2 text-end">Total</div>
</div>

<div id="cart-items"></div>

<button class="btn btn-outline-secondary mt-3" onclick="location.href='index.html'">
  ← Back to Shop
</button>

</div>

<!-- RIGHT -->
<div class="col-lg-4 mt-4">
<div class="border p-3">

<h5>Order Summary</h5>

<div class="d-flex justify-content-between">
  <span>Subtotal</span><span>₹<span id="subtotal">0</span></span>
</div>

<div class="d-flex justify-content-between">
  <span>Tax (10%)</span><span>₹<span id="tax">0</span></span>
</div>

<div class="mt-2">
  <input class="form-control" id="coupon" placeholder="Coupon Code">
  <button class="btn btn-sm btn-dark w-100 mt-2" onclick="applyCoupon()">Apply</button>
</div>

<hr>

<div class="d-flex justify-content-between fw-bold fs-4">
  <span>Total</span><span>₹<span id="cart-total">0</span></span>
</div>

<p class="mt-3 small">Congrats! Free shipping above ₹1000</p>
<div class="progress">
  <div id="ship-bar" class="progress-bar bg-success"></div>
</div>

<button class="btn btn-dark w-100 mt-3" onclick="checkout()">Checkout</button>

</div>
</div>

</div>
</div>

<!-- ===== SCRIPTS ===== -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* LOGIN CHECK */
if(localStorage.getItem('loggedIn')!=='true'){
  location.href='login.html';
}

/* CART */
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let discount = 0;

function renderCart(){
  const cartItems = document.getElementById('cart-items');
  let subtotal = 0;
  cartItems.innerHTML = '';

  cart.forEach((item,i)=>{
    subtotal += item.price * item.qty;

    cartItems.innerHTML += `
    <div class="row cart-item align-items-center">
      <div class="col-6 d-flex gap-3">
        <img src="${item.image}">
        <strong>${item.name}</strong>
      </div>

      <div class="col-2">₹${item.price}</div>

      <div class="col-2">
        <div class="qty-box">
          <button onclick="updateQty(${i},-1)">-</button>
          <span>${item.qty}</span>
          <button onclick="updateQty(${i},1)">+</button>
        </div>
      </div>

      <div class="col-2 text-end">
        ₹${item.price * item.qty}
        <span class="remove ms-2" onclick="removeItem(${i})">✖</span>
      </div>
    </div>`;
  });

  const tax = subtotal * 0.1;
  let total = subtotal + tax - discount;

  document.getElementById('subtotal').innerText = subtotal;
  document.getElementById('tax').innerText = tax;
  document.getElementById('cart-total').innerText = total;
  document.getElementById('item-count').innerText = cart.length;

  document.getElementById('ship-bar').style.width =
    Math.min((subtotal/1000)*100,100) + '%';

  localStorage.setItem('cart',JSON.stringify(cart));
}

function updateQty(i,val){
  cart[i].qty += val;
  if(cart[i].qty < 1) cart[i].qty = 1;
  renderCart();
}

function removeItem(i){
  cart.splice(i,1);
  renderCart();
}

function applyCoupon(){
  if(document.getElementById('coupon').value === "SAVE100"){
    discount = 100;
    alert("Coupon Applied!");
    renderCart();
  } else {
    alert("Invalid Coupon");
  }
}

function checkout(){
  if(cart.length === 0){
    alert("Cart is empty");
    return;
  }
  alert("Order Placed Successfully!");
  cart = [];
  localStorage.setItem('cart','[]');
  renderCart();
}

/* LOGOUT */
document.getElementById('logout-btn').addEventListener('click',()=>{
  localStorage.removeItem('loggedIn');
  localStorage.removeItem('cart');
  location.href='login.html';
});

renderCart();
</script>

</body>
</html>
